<Window x:Class="FlipPix.UI.ChunkCreatorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FlipPix.UI.Converters"
        mc:Ignorable="d"
        Title="FlipPix Chunk Creator"
        Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        WindowState="Normal"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize"
        MinHeight="500" MinWidth="700"
        MaxHeight="900" MaxWidth="1400">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="15,10">
                
                <!-- ComfyUI Connection Settings -->
                <GroupBox Header="ComfyUI Connection" Margin="0,0,0,10">
                    <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="15"/>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Server:" Grid.Column="0" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding ComfyUIServer}" Grid.Column="1" VerticalAlignment="Center"/>

                        <TextBlock Text="Port:" Grid.Column="3" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding ComfyUIPort}" Grid.Column="4" VerticalAlignment="Center"/>
                    </Grid>
                </GroupBox>
                
                <!-- File Selection -->
                <GroupBox Header="Input Files" Margin="0,0,0,10">
                    <StackPanel Margin="8">
                        <!-- Video File -->
                        <Grid Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Video File:" Grid.Column="0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding VideoFilePath}" Grid.Column="1"
                                    IsReadOnly="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <Button Content="Browse..." Grid.Column="2"
                                    Command="{Binding SelectVideoFileCommand}"/>
                        </Grid>

                        <!-- Video Info -->
                        <TextBlock Text="{Binding VideoInfo}" FontStyle="Italic" FontSize="10"
                                  Foreground="Gray" Margin="100,0,0,6"/>

                        <!-- Reference Image 1 -->
                        <Grid Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Ref Image 1:" Grid.Column="0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding ReferenceImage1Path}" Grid.Column="1"
                                    IsReadOnly="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <Button Content="Browse..." Grid.Column="2"
                                    Command="{Binding SelectReferenceImage1Command}"/>
                        </Grid>

                        <!-- Reference Image 2 -->
                        <Grid Margin="0,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Ref Image 2:" Grid.Column="0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding ReferenceImage2Path}" Grid.Column="1"
                                    IsReadOnly="True" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <Button Content="Browse..." Grid.Column="2"
                                    Command="{Binding SelectReferenceImage2Command}"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- Prompt -->
                <GroupBox Header="Prompt" Margin="0,0,0,10">
                    <TextBox Text="{Binding Prompt}" TextWrapping="Wrap"
                            AcceptsReturn="True" MinHeight="50" Margin="8"/>
                </GroupBox>
                
                <!-- Processing Controls -->
                <GroupBox Header="Processing" Margin="0,0,0,10">
                    <StackPanel Margin="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Content="Start" Grid.Column="0"
                                    Command="{Binding StartProcessingCommand}"
                                    IsEnabled="{Binding CanStartProcessing}"
                                    Height="28" Margin="0,0,4,0"
                                    Background="#27AE60" Foreground="White" FontWeight="Bold"/>

                            <Button Content="Stop" Grid.Column="1"
                                    Command="{Binding StopProcessingCommand}"
                                    IsEnabled="{Binding CanStopProcessing}"
                                    Height="28" Margin="4,0,4,0"
                                    Background="#E74C3C" Foreground="White" FontWeight="Bold"/>

                            <Button Content="Open Output" Grid.Column="2"
                                    Command="{Binding OpenOutputFolderCommand}"
                                    Height="28" Margin="4,0,0,0"/>
                        </Grid>

                        <!-- Progress -->
                        <TextBlock Text="{Binding ProcessingStatus}" Margin="0,8,0,4" FontWeight="Bold" FontSize="11"/>
                        <ProgressBar Value="{Binding ProcessingProgress}" Height="18" Margin="0,0,0,4"/>
                        <TextBlock Text="{Binding ChunkProgressStatus}" HorizontalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Generated Chunks -->
                <GroupBox Header="Generated Chunks" Margin="0,0,0,10">
                    <ListBox ItemsSource="{Binding GeneratedChunks}"
                            MaxHeight="100" Margin="8"
                            ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" FontFamily="Consolas" FontSize="10"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </GroupBox>

                <!-- Finished Video -->
                <GroupBox Header="Finished Video" Margin="0,0,0,10" Visibility="{Binding HasFinishedVideo, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Margin="8">
                        <TextBlock Text="{Binding JoiningStatus}" FontWeight="Bold" Foreground="#27AE60" Margin="0,0,0,6" FontSize="11"/>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Local Path:" Grid.Column="0" VerticalAlignment="Center" FontWeight="Bold" FontSize="11"/>
                            <TextBlock Text="{Binding LocalFinishedVideoPath}" Grid.Column="1"
                                      VerticalAlignment="Center" TextWrapping="Wrap"
                                      FontFamily="Consolas" FontSize="10"/>
                        </Grid>

                        <Button Content="â–¶ Open Finished Video"
                                Command="{Binding OpenFinishedVideoCommand}"
                                Height="32" FontSize="12" FontWeight="Bold"
                                Background="#3498DB" Foreground="White"
                                HorizontalAlignment="Stretch"/>
                    </StackPanel>
                </GroupBox>

            </StackPanel>
        </ScrollViewer>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="1">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusBarMessage}" FontSize="11"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Chunks: " FontSize="11"/>
                    <TextBlock Text="{Binding CompletedChunks}" FontWeight="Bold" FontSize="11"/>
                    <TextBlock Text="/" FontSize="11"/>
                    <TextBlock Text="{Binding TotalChunks}" FontWeight="Bold" FontSize="11"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="4"/>
        </Style>
        <Style TargetType="GroupBox">
            <Setter Property="Padding" Value="4"/>
        </Style>
    </Window.Resources>
</Window>